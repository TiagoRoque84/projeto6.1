{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="mb-0">Frota de Veículos</h3>
  <a class="btn btn-success" href="{{ url_for('fleet.new') }}">Novo Veículo</a>
</div>
<table class="table table-striped table-hover align-middle">
  <thead>
    <tr>
      <th>Nome / Descrição</th>
      <th>Placa</th>
      <th>Licenciamento</th>
      <th>Última KM (Óleo)</th>
      <th>Próxima Troca (KM)</th>
      <th style="width: 220px;"></th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
    <tr>
      <td><b>{{ item.vehicle.nome }}</b><br><small class="text-muted">{{ item.vehicle.descricao }}</small></td>
      <td><span class="badge bg-secondary">{{ item.vehicle.placa }}</span></td>
      <td>{{ item.vehicle.venc_licenciamento.strftime('%d/%m/%Y') if item.vehicle.venc_licenciamento else '-' }}</td>
      <td>{{ item.last_oil_change.km_atual if item.last_oil_change else 'N/A' }}</td>
      <td>{{ item.last_oil_change.km_proxima_troca if item.last_oil_change else 'N/A' }}</td>
      <td class="text-end">
        <div class="d-flex gap-2 justify-content-end">
            <a class="btn btn-sm btn-outline-primary" href="{{ url_for('fleet.details', vehicle_id=item.vehicle.id) }}">Ver Ficha</a>
            <form method="post" action="{{ url_for('fleet.delete', vehicle_id=item.vehicle.id) }}" onsubmit="return confirm('Tem a certeza que deseja excluir este veículo? A ação não pode ser desfeita.');">
                <button type="submit" class="btn btn-sm btn-outline-danger">Excluir</button>
            </form>
        </div>
      </td>
    </tr>
    {% else %}
    <tr><td colspan="6" class="text-center">Nenhum veículo registado.</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}